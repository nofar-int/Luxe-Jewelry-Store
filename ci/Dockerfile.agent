FROM jenkins/agent:latest

USER root

# התקנת כלים בסיסיים
RUN apt-get update && \
    apt-get install -y docker.io git python3 python3-pip python3-venv python3-setuptools unzip curl flake8 && \
    rm -rf /var/lib/apt/lists/*

# התקנת Node.js + npm
RUN curl -fsSL https://deb.nodesource.com/setup_20.x | bash - && \
    apt-get install -y nodejs && \
    npm install -g npm@latest

# התקנת Snyk CLI
RUN npm install -g snyk@latest

# התקנת pylint, pytest ו-pytest-html בתוך virtual environment
RUN python3 -m venv /opt/jenkins_venv && \
    /opt/jenkins_venv/bin/pip install --upgrade pip setuptools wheel && \
    /opt/jenkins_venv/bin/pip install pylint pytest pytest-html

# הוספת venv ל-PATH
ENV PATH="/opt/jenkins_venv/bin:$PATH"

# ✅ התקנת Docker Compose (גרסה בינארית רשמית)
RUN curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" \
    -o /usr/local/bin/docker-compose && \
    chmod +x /usr/local/bin/docker-compose && \
    docker-compose --version

# ניקוי
RUN apt-get clean && rm -rf /var/lib/apt/lists/*

USER jenkins




